{% extends 'base.html.twig' %}

{% block title %}Hello ManagerController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    .wide-col {width:250px}
</style>

<!-- Start of first page -->
<div data-role="page" id="manager">
	<div class="example-wrapper">

		<div role="main" class="ui-content">
			<h1>Manager</h1>
			<div id="progress-orders"></div>

			<div id="dispatched-orders"></div>

			<div id="complete-orders"></div>
			
		</div>
		<!-- /content -->
	</div>
</div>
<script>
$.post("/ManagersOrders", {type:'progress'}).done(function(data){
	$('#progress-orders').html(data);
	replaceComma('.format-text');
	replaceComma('.format-add-text');
	$('.cancel-order').on('click',function(event){
	var cancelId = $(this).closest('tr').find('.order-id').html();
	$.post("/ManagersOrders" , {type:'cancel', id:cancelId}).done(function(data){
	window.location="/Manager";
	});
});
});

$.post("/ManagersOrders", {type: 'dispatched'}).done(function(data){
	$('#dispatched-orders').html(data);
	replaceComma('.format-text');
	replaceComma('.format-add-text');
});

$.post("/ManagersOrders", {type:'complete'}).done(function(data){
	$('#complete-orders').html(data);
	replaceComma('.format-text');
	replaceComma('.format-add-text');
})


function replaceComma(x){
	$('.single-order').each(function(){
		var oldText = $(this).closest('tr').find(x).html();
		var newText = oldText.replace(/,/g, '<br>');
		console.log(newText);
		$(this).closest('.single-order').find(x).html(newText);
	})
}
</script>
{% endblock %}
